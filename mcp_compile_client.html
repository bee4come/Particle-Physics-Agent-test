<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MCP TikZ Compile Test</title>
  <style>
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:#0b0b0b; color:#e5e7eb; margin:20px; }
    textarea { width: 100%; height: 220px; background:#0f172a; color:#e5e7eb; border:1px solid #334155; border-radius:8px; padding:10px; }
    .row { margin: 10px 0; }
    button { background:#2563eb; color:#fff; padding:8px 12px; border:0; border-radius:8px; cursor:pointer; }
    select, input { background:#0f172a; color:#e5e7eb; border:1px solid #334155; border-radius:8px; padding:6px 8px; }
    #result { margin-top: 12px; padding: 10px; background:#111827; border:1px solid #374151; border-radius:8px; white-space:pre-wrap; }
    .ok { color:#22c55e }
    .err { color:#ef4444 }
  </style>
  <script>
    async function compileNow() {
      const tikz = document.getElementById('tikz').value;
      const engine = document.getElementById('engine').value;
      const endpoint = document.getElementById('endpoint').value;
      const payload = {
        jsonrpc: "2.0",
        id: "test-1",
        method: "tools/call",
        params: {
          name: "latex_compile",
          arguments: { tikz, engine, timeoutSec: 20 }
        }
      };
      const resEl = document.getElementById('result');
      resEl.textContent = 'Compiling...';
      try {
        const resp = await fetch(endpoint, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        const data = await resp.json();
        const r = data.result || {};
        resEl.textContent = 'status: ' + r.status + '\n' + JSON.stringify(r, null, 2);
        resEl.className = r.status === 'ok' ? 'ok' : 'err';
      } catch (e) {
        resEl.textContent = 'error: ' + e.message;
        resEl.className = 'err';
      }
    }
  </script>
</head>
<body>
  <h1>MCP TikZ Compile Test</h1>
  <div class="row">
    <label>Endpoint</label>
    <input id="endpoint" size="40" value="http://127.0.0.1:8003/mcp" />
    <label>Engine</label>
    <select id="engine">
      <option value="lualatex" selected>lualatex</option>
      <option value="pdflatex">pdflatex</option>
    </select>
    <button id="compileBtn" onclick="compileNow()">Compile via MCP</button>
  </div>
  <div class="row">
    <textarea id="tikz">\begin{tikzpicture}
\begin{feynman}
  \diagram* {
    e1 [particle= $e^-$] -- [fermion] a -- [fermion] e2 [particle= $e^+$],
    a -- [photon, edge label=$\gamma$] b,
  };
\end{feynman}
\end{tikzpicture}
    </textarea>
  </div>
  <div id="result" aria-label="compile-result"></div>
</body>
</html>

